<!-- <p>tasks works</p>
<button (click)="getAllTasks()">Get Tasks</button>
<button (click)="getTaskById()">Get Task by id</button>
<button (click)="createTask()">Post Task</button>
<button (click)="updateTask()">Put Task</button>
<button (click)="deleteTask()">Delete Task</button> -->

<div class="p-4 space-y-4">
  <!-- Search & Filters -->
  <div class="flex flex-wrap items-center gap-4">
    <mat-form-field appearance="outline" class="w-full sm:w-auto">
      <mat-label>Buscar por título</mat-label>
      <input matInput (input)="applyFilter($event)" placeholder="Buscar...">
    </mat-form-field>


    <mat-form-field appearance="outline" class="w-full sm:w-auto">
      <mat-label>Filtrar por estado</mat-label>
      <mat-select [(value)]="filters.status" (selectionChange)="loadTasks()">
        <mat-option value="">Todos</mat-option>
        <mat-option *ngFor="let s of statuses" [value]="s">{{s}}</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" class="w-full sm:w-auto">
      <mat-label>Prioridad</mat-label>
      <mat-select [(value)]="filters.priority" (selectionChange)="loadTasks()">
        <mat-option value="">Todas</mat-option>
        <mat-option *ngFor="let p of priorities" [value]="p">{{p}}</mat-option>
      </mat-select>
    </mat-form-field>

    <div class="flex flex-wrap items-center gap-2">
      <mat-label>Filtrar por etiquetas:</mat-label>
      <mat-chip-list>
        <mat-chip color="warn" (click)="clearTagFilters()" [disabled]="filters.tags.length === 0"
          class="cursor-pointer">
          Limpiar filtros
        </mat-chip>

        <mat-chip *ngFor="let tag of allTags" [selected]="filters.tags.includes(tag)" (click)="toggleTagFilter(tag)"
          [color]="filters.tags.includes(tag) ? 'primary' : undefined" selectable>
          {{ tag }}
        </mat-chip>
      </mat-chip-list>
    </div>



  </div>

  <!-- Tabla de tareas -->
  <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z2 w-full bg-white rounded shadow">
    <ng-container matColumnDef="title">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Título</th>
      <td mat-cell *matCellDef="let task">{{task.title}}</td>
    </ng-container>

    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Estado</th>
      <td mat-cell *matCellDef="let task">{{task.status}}</td>
    </ng-container>

    <ng-container matColumnDef="priority">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Prioridad</th>
      <td mat-cell *matCellDef="let task">{{task.priority}}</td>
    </ng-container>

    <ng-container matColumnDef="dueDate">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Fecha Límite</th>
      <!-- <td mat-cell *matCellDef="let task">{{task.dueDate | date: 'dd/MM/yyyy - hh:mm:ss a'}}</td> -->
      <td mat-cell *matCellDef="let task">{{task.dueDate}}</td>
    </ng-container>

    <ng-container matColumnDef="tags">
      <th mat-header-cell *matHeaderCellDef>Etiquetas</th>
      <td mat-cell *matCellDef="let task">
        <mat-chip-set>
          @for (tag of task.tags; track tag) {
          <mat-chip>{{ tag }}</mat-chip>
          }
        </mat-chip-set>
      </td>
    </ng-container>

    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>Acciones</th>
      <td mat-cell *matCellDef="let task">
        <button mat-icon-button color="primary" (click)="editTask(task)">
          <mat-icon>edit</mat-icon>
        </button>
        <button mat-icon-button color="warn" (click)="confirmDelete(task)">
          <mat-icon>delete</mat-icon>
        </button>
        <button mat-icon-button (click)="viewHistory(task)">
          <mat-icon>history</mat-icon>
        </button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
    <tr mat-row *matRowDef="let row; columns: columnsToDisplay;"></tr>
  </table>

  <mat-paginator [pageSize]="5"></mat-paginator>

  <mat-card class="p-4" *ngIf="true">
    <form [formGroup]="form" (ngSubmit)="submitForm()" class="space-y-4">

      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Título</mat-label>
        <input matInput formControlName="title">
        <mat-error *ngIf="form.get('title')?.hasError('required')">Requerido</mat-error>
        <mat-error *ngIf="form.get('title')?.hasError('minlength')">Mínimo 3 caracteres</mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Descripción</mat-label>
        <textarea matInput formControlName="description"></textarea>
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Estado</mat-label>
        <mat-select formControlName="status">
          <mat-option *ngFor="let s of statuses" [value]="s">{{ s }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Prioridad</mat-label>
        <mat-select formControlName="priority">
          <mat-option *ngFor="let p of priorities" [value]="p">{{ p }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Fecha límite</mat-label>
        <input matInput type="date" formControlName="dueDate">
        <mat-error *ngIf="form.get('dueDate')?.hasError('required')">Requerido</mat-error>
      </mat-form-field>

      <div>
        <mat-form-field class="w-full" appearance="outline">
          <mat-label>Etiquetas</mat-label>
          <mat-chip-list #chipList formArrayName="tags">
            <mat-chip *ngFor="let tag of tags.controls; let i = index" [selectable]="true" [removable]="true"
              (removed)="removeTag(i)">
              {{ tag.value }}
              <mat-icon matChipRemove>cancel</mat-icon>
            </mat-chip>
            <input placeholder="Nueva etiqueta" [matChipInputFor]="chipList" [matChipInputSeparatorKeyCodes]="[13,188]"
              [matChipInputAddOnBlur]="true" (matChipInputTokenEnd)="addTagFromEvent($event)" />
          </mat-chip-list>
        </mat-form-field>
      </div>

      <button mat-raised-button color="primary" type="submit">
        {{ isEditing ? 'Actualizar' : 'Crear' }} Tarea
      </button>
    </form>
  </mat-card>

  <!-- Formulario modal o expandible debajo si decides integrarlo aquí -->
</div>
